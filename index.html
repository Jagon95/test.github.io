<html>
<head>
    <title>Test Vk OAuth 2.0</title>
    <script src="script.js"></script>
    <!--<link type="text/css" rel="stylesheet" href="friends.css">-->
    <!--<link type="text/css" rel="stylesheet" href="common.css">-->
    <link type="text/css" rel="stylesheet" href="style.css">
    <link type="" rel="stylesheet" href="style.css">
</head>
<body>
<script language="javascript">

//    const TOKEN = '8c323488e2e8637156cb06d877598089d5f9e227c19534f5a7e302507f0e55ed0c30a7db0bcc89d068d7b';





    //https://oauth.vk.com/authorize?client_id=6054906&scope=rights.join(',')&redirect_uri=https://jagon95.github.io&display=page&response_type=token
    //https://oauth.vk.com/authorize?client_id=6054906&scope=friends&redirect_uri=http://oauth.vk.com/blank.html&display=page&response_type=token

    //cce4bc87ad9b7d36127a9884cb4bf131641ff41b85aa42967602761d8e0c247f2064032b68aa2d0abf904
    //    VK.Auth.getLoginStatus(authInfo);
    //    VK.UI.button('login_button');
    //    https://api.vk.com/method/METHOD_NAME?PARAMETERS&access_token=ACCESS_TOKEN

//    function getToken() {
//        xhr = new XMLHttpRequest();
//        xhr.open('GET', 'https://oauth.vk.com/authorize?client_id=6054906&scope=friends&redirect_uri=http://oauth.vk.com/blank.html&display=page&response_type=token');
//        xhr.onreadystatechange = function() {
//            if (xhr.readyState != 4) return;
//
//            if (xhr.status != 200) {
//                alert(xhr.status + ': ' + xhr.statusText);
//            } else {
//                alert(xhr.responseText);
//            }
//
//        }
//        xhr.send();
//    }





    //если нет куки
        //кнопка авторизации
        //иначе авторизация



        //если хорошо - рисуем блок с именем и списком друзей
        //  кнопка релоад - для того, чтобы показать других друзей
        //иначе выводим сообщение о том, что все плохо
        //  и предлагаем залогиниться еще



    window.onload = function () {

        var token = window.location.hash.match(/access_token=([0-9a-f]+)/);
        var auth_button = document.getElementById('auth_button');
        var show_friends_button = document.getElementById('show_friends_button');

        if (token) {
            auth_button.style.display = "none";
            token = token[1];
            var expires = window.location.hash.match(/expires_in=([0-9]+)/);
            setCookie('token', token, expires ? expires[1] * 1000 : 0);
            window.location.hash = '';
        }
        else {
            token = getCookie('token');
            if (!token) {
                show_friends_button.style.display = "none";
            } else {
                auth_button.style.display = "none";
            }

        }

    }


    </script>

    <button onclick="get5RandomFriends()" class="flat_button" id="show_friends_button">Показать друзей</button>
    <!--<button onclick="getToken()">Токен</button>-->
<a class="flat_button" href="https://oauth.vk.com/authorize?client_id=6054906&scope=friends&redirect_uri=https://jagon95.github.io&display=page&response_type=token" id="auth_button">Авторизоваться</a>
    <div class="wide_column_wrap" id="friend_list_wrapper">
        <div class="wide_column" id="wide_column">
            <div id="friends" class="page_block clear_fix">
                <div id="friends_list" class="friends_list">
                    <div class="friends_list_bl" id="friends_container">
                    </div>
                </div>
                <div id="page_end"></div>
            </div>
        </div>
    </div>

<template id="friend_template">
    <div class="friends_user_row clear_fix" id="friends_user_row{{id}}">
        <div id="res{{id}}"></div>
        <div class="friends_photo_wrap">
            <a class="friends_photo _online" href="https://vk.com/id{{id}}"><img class="friends_photo_img"
                                                                                 alt="{{fullname}}"
                                                                                 src="{{photo}}"></a>
        </div>
        <div class="friends_user_info">
            <div class="friends_field friends_field_title"><a href="https://vk.com/id{{id}}">{{fullname}}</a>
            </div>
            <div class="friends_field">{{study}}</div>

            <a href="https://vk.com/write{{id}}" class="friends_field_act"
               onclick="return showWriteMessageBox(event, {{id}})">Написать сообщение</a>
        </div>
    </div>
</template>

</body>
</html>
